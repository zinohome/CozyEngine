## 00. 愿景与范围（CozyEngine v2）

> **文档版本**: v2.0  
> **更新日期**: 2026-01-09  


### 0.1 一句话愿景

把 CozyChat 的“对话能力”抽象成 **CozyEngine：人格化、插件式的聊天引擎**——可独立部署、可插拔扩展、对外兼容 OpenAI Chat Completions，对内为 CozyChat 前端提供稳定 API。

### 0.2 产品/工程目标

- **可插拔**：AI 引擎、工具引擎、知识/画像/记忆三大人格化引擎均可替换。
- **人格化**：人格配置驱动（Prompt/工具/记忆策略/语音策略），并支持多人格并存与热更新（受控）。
- **兼容性**：对外兼容 OpenAI API（核心为 `/v1/chat/completions`），对内兼容 CozyChat 现有 API（会话、消息、工具、音频等）。
- **可观测**：结构化日志、指标、链路追踪（可选），有明确的错误码与降级策略。
- **可测试**：分层可单测/集测，关键链路可端到端；引擎可 Mock。
- **性能**：并行上下文组装（知识/画像/记忆），缓存分层；目标在单机场景下稳定支撑交互式 QPS。

### 0.3 非目标（本期不做/延后）

- **前端重写**：CozyChat 前端保持尽量不变，优先做后端引擎化。
- **多租户计费系统**：可预留租户字段，但不引入复杂计费。
- **大规模分布式调度**：先做单体可扩展与容器化部署，再演进。
- **全量向量知识平台替换**：允许接入 Cognee/Mem0/Memobase 等，但不强制统一成单一平台。

### 0.4 设计约束（从 CozyChat 继承）

来自 CozyChat 现有实现的关键约束（必须承接）：

- **编排器模式已落地**：API 层应保持轻薄，核心流程集中在编排层。
- **异步 + 并行是核心**：上下文构建天然并行；流式输出使用 SSE。
- **全局生命周期初始化**：人格注册表、工具工厂、LLM 引擎池等在应用启动时初始化，避免请求内重复构建。
- **配置优先级明确**：YAML > 环境变量（Settings）> 代码默认值。

### 0.5 产出物范围（文档集）

本套 v2 文档将产出：

- 架构与分层规范
- 插件系统与引擎接口规范
- 编排与上下文构建链路设计
- API 设计（OpenAI 兼容 + CozyChat 兼容）
- 数据与存储、配置、可观测、性能、测试
- 迁移/实施计划、部署运行、安全权限

