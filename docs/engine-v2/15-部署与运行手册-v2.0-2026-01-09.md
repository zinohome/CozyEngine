## 15. 部署与运行手册

> **文档版本**: v2.0  
> **更新日期**: 2026-01-09  


### 15.1 部署形态

- **单体服务（推荐起步）**：FastAPI + Postgres + Redis
- **外部依赖**：OpenAI/Ollama、Cognee、Memobase、Mem0（按需）

### 15.2 运行前检查清单

- 环境变量：密钥是否齐全（OpenAI、JWT、外部引擎）
- DB 连接：迁移/建表是否完成
- Redis：可用性与连接池配置
- 引擎健康检查：`/health/engines`（建议提供）

### 15.3 反向代理与 SSE

- 反代必须关闭缓冲（例如 `X-Accel-Buffering: no`）
- SSE 连接超时要与代理配置协同（keep-alive）

### 15.4 灰度与回滚

- 灰度维度：环境 → 用户 → 会话 → 人格
- 回滚：开关切回旧服务；数据层保持兼容（软删/版本字段）

