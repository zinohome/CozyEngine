## 16. 安全与权限模型

> **文档版本**: v2.0  
> **更新日期**: 2026-01-09  


### 16.1 鉴权

- 默认：JWT Bearer Token
- 必须：所有涉及 user/session/message 的接口都需鉴权
- 允许：少量公开接口（`/health`、`/docs`）按环境受控

### 16.2 授权（RBAC）

角色建议：

- `user`：只能访问自己的数据
- `admin`：可做运维级动作（人格重载、工具发现、配置查看（脱敏））

规则（必须）：

- session/messages 的读写必须校验 `session.user_id == current_user.id`
- 管理员动作必须审计（audit_events）

### 16.3 工具权限（关键风险点）

工具调用必须满足：

- 人格白名单（allowed_tools）
- 工具声明的副作用等级与服务策略匹配
- 运行时参数校验（schema）
- 工具执行必须落审计事件（包括失败）

### 16.4 外部引擎密钥管理

- 密钥只来自环境变量或密钥管理系统，不写入 YAML/代码/日志。
- 所有请求日志必须脱敏（headers、token、cookie）。

