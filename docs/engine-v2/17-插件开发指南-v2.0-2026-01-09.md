## 17. 插件开发指南（引擎插件）

> **文档版本**: v2.0  
> **更新日期**: 2026-01-09  


### 17.1 目标读者

给希望新增/替换引擎实现的人：

- 新增一个 AI provider
- 接入一个新的知识库/画像/记忆服务
- 新增工具引擎（例如内网工具集）

### 17.2 开发步骤（通用）

1. **选择引擎类型**：AI / Tools / Knowledge / UserProfile / ChatMemory / Voice
2. **实现接口**：按 `06-引擎接口规范.md`
3. **声明插件元数据**：
   - provider 名称
   - 支持的 api_version
   - 权限声明（network/data/tools side-effect）
4. **注册到 Registry**：
   - 内置：在 `engines/*/factory.py` 注册
   - 外置：通过 entry-points 或配置动态导入注册
5. **编写测试**：
   - 初始化/健康检查
   - 成功路径
   - 超时/异常路径

### 17.3 质量门槛（必须）

- 任何网络调用必须有超时
- 任何异常必须转换为可分类异常（Engine*Error）
- 不得在插件内打印敏感信息
- 结果结构必须稳定（即使内容不稳定）

### 17.4 兼容建议

如果插件目标是兼容 CozyChat 的行为：

- 保持字段命名一致（例如 memories/profile/knowledge）
- 保持降级时返回空结构（不要返回 None 导致下游判空混乱）

